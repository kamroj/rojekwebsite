---
import SiteLayout from '../../layouts/SiteLayout.astro';
import Section from '../../components/ui/Section.jsx';
import MaxWidthContainer from '../../components/ui/MaxWidthContainer.jsx';
import PageHeader from '../../components/ui/PageHeader.jsx';
import BreadcrumbsSsg from '../../components/_astro/ssg/BreadcrumbsSsg.astro';
import { ArticleCard } from '../../components/sections/articles/index.js';
import PaginationSsg from '../../components/_astro/ssg/PaginationSsg.astro';
import { fetchAllArticles, fetchArticlesPageSettings } from '../../lib/sanity/articles.js';
import { getArticlesIndexPath } from '../../lib/i18n/routing.js';
import { paginateArticles, getArticlesPagination } from '../../lib/articlesPagination.js';
import homeHeaderStyles from '../../views/HomeView.module.css';

const lang = 'pl';
const allArticles = await fetchAllArticles();
const pageSettings = await fetchArticlesPageSettings();
const pageData = paginateArticles(allArticles, 1);
const pagination = getArticlesPagination({
  lang,
  currentPage: pageData.currentPage,
  totalItems: pageData.totalItems,
});

// SEO
const title = 'Artykuły | ROJEK – Okna i Drzwi';
const description = 'Przeczytaj nasze artykuły o oknach, drzwiach, montażu i trendach w stolarce budowlanej. Porady ekspertów i aktualności branżowe.';
const canonicalUrl = getArticlesIndexPath(lang);

const breadcrumbs = [
  { label: 'Strona główna', to: '/' },
  { label: 'Artykuły' },
];
---

<SiteLayout
  lang={lang}
  title={title}
  description={description}
  canonicalUrl={canonicalUrl}
>
  <PageHeader
    image={pageSettings.headerImage}
    imageSrc="/images/contactus/top.jpg"
    title={pageSettings.headerTitle?.toUpperCase() || 'ARTYKUŁY'}
    height={420}
    overlayColor="rgba(0,0,0,0.55)"
    imgLoading="eager"
    imgFetchPriority="high"
    imgSizes="100vw"
  />

  <Section>
    <MaxWidthContainer>
      <BreadcrumbsSsg items={breadcrumbs} />

      <div class={`${homeHeaderStyles.headerWrap} full-width`}>
        <div class={homeHeaderStyles.productHeader}>{pageSettings.headerTitle || 'ARTYKUŁY'}</div>
        <div class={homeHeaderStyles.productHeaderSubtitle}>
          {pageSettings.headerSubtitle || 'Wiedza i inspiracje ze świata stolarki budowlanej'}
        </div>
      </div>

      {pageData.items.length > 0 ? (
        <div class="articles-list">
          {pageData.items.map((article) => (
            <ArticleCard article={article} lang={lang} />
          ))}
        </div>
      ) : (
        <div class="empty-state">
          <p>Brak artykułów do wyświetlenia.</p>
        </div>
      )}

      <PaginationSsg pagination={pagination} ariaLabel="Paginacja artykułów" />
    </MaxWidthContainer>
  </Section>
</SiteLayout>

<style>
  .articles-list {
    display: flex;
    flex-direction: column;
  }

  .empty-state {
    text-align: center;
    padding: var(--space-2xl);
    color: var(--color-text-muted);
  }

</style>
