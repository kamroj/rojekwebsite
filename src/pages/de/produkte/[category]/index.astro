---
// @ts-nocheck
import SiteLayout from '../../../../layouts/SiteLayout.astro';
import { getI18nResources } from '../../../../lib/i18n/resources.js';
import ProductCategorySsg from '../../../../components/_astro/ssg/ProductCategorySsg.jsx';

import { productCategories } from '../../../../data/products/index.js';
import { CATEGORY_SLUGS } from '../../../../lib/i18n/routing.js';
import { fetchDoorsListForBuild, fetchWindowsListForBuild } from '../../../../lib/sanity/build.js';
import { getProductCategoryMeta } from '../../../../lib/seo/productsMeta.js';

const { category } = Astro.params;

const initialSanityProducts = Astro.props?.initialSanityProducts;

const resources = await getI18nResources('de');

const meta = getProductCategoryMeta({ lang: 'de', categorySlug: category });

export async function getStaticPaths() {
  const paths = [];

  for (const categoryKey of Object.keys(productCategories || {})) {
    const categorySlug = CATEGORY_SLUGS?.de?.[categoryKey] || categoryKey;

    const props = {};
    if (categoryKey === 'okna') {
      const windows = await fetchWindowsListForBuild('de');
      if (windows) props.initialSanityProducts = windows;
    } else if (categoryKey === 'drzwi') {
      const doors = await fetchDoorsListForBuild('de');
      if (doors) props.initialSanityProducts = doors;
    }

    paths.push({
      params: { category: categorySlug },
      props,
    });
  }

  return paths;
}
---

<SiteLayout
  lang="de"
  title={meta.title}
  description={meta.description}
>
  <ProductCategorySsg
    lang="de"
    resources={resources}
    category={category}
    initialSanityProducts={initialSanityProducts}
  />
</SiteLayout>
