---
// @ts-nocheck
import SiteLayout from '../../../layouts/SiteLayout.astro';
import RealizationsPageSsg from '../../../components/_astro/ssg/pages/RealizationsPageSsg.astro';
import { fetchRealizationsPageData } from '../../../lib/sanity/realizations.js';
import { paginateRealizations, getRealizationsPagination } from '../../../lib/realizationsPagination.js';

const { page } = Astro.params;
const currentPage = Number.parseInt(String(page || '1'), 10) || 1;

const allRealizations = await fetchRealizationsPageData({ lang: 'pl' });
const pageData = paginateRealizations(allRealizations, currentPage);

export async function getStaticPaths() {
  const allRealizations = await fetchRealizationsPageData({ lang: 'pl' });
  const firstPageData = paginateRealizations(allRealizations, 1);

  const paths = [];
  for (let p = 2; p <= firstPageData.totalPages; p += 1) {
    paths.push({ params: { page: String(p) } });
  }
  return paths;
}

const pagination = getRealizationsPagination({
  lang: 'pl',
  currentPage: pageData.currentPage,
  totalItems: pageData.totalItems,
});
---

<SiteLayout
  lang="pl"
  title="Realizacje – ROJEK | Zobacz nasze realizacje"
  description="Galeria realizacji ROJEK: okna, drzwi i rozwiązania przesuwne. Zobacz przykłady montażu i wykończeń."
>
  <RealizationsPageSsg lang="pl" realizations={pageData.items} pagination={pagination} />
</SiteLayout>
